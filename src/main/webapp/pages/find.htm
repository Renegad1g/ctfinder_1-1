<div class="container">
	<div class="row flex">
		<div class="col s1 valign-wrapper">
			<ul id="slide-out" class="sidenav">
				<li>
					<ul class="collapsible">
						<li>
							<div class="collapsible-header">
								<i class="material-icons">list</i>Категории
							</div>
							<div class="collapsible-body">
								<form id="categories" action="#">
									<p>
										<label for="category-1"> <input id="category-1"
											type="checkbox" /><span>волонтерская помощь</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>дизайн</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>естественные
												науки</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>помощь
												животным</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>природа</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>проектирование
												техники</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>промышленность</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>разработка
												приложений</span>
										</label>
									</p>
									<p>
										<label> <input type="checkbox" /> <span>общественные
												науки</span>
										</label>
									</p>
								</form>
							</div>
						</li>
						<li>
							<div class="collapsible-header">
								<i class="material-icons">filter_list</i>Фильтр
							</div>
							<div class="collapsible-body">
								<div class="row">
									<div class="input-field col s12">
										<input type="text" id="country-input" class="autocomplete">
										<label for="country-input">Страна</label>
									</div>
								</div>
								<div class="row">
									<div class="input-field col s12">
										<input type="text" id="city-input" class="autocomplete">
										<label for="city-input">Город</label>
									</div>
								</div>
								<div class="row">
									<div class="input-field col s12">
										<label for="manicurists-select">
				                            TODO:
				                        </label>
		                                <!-- Сюда при помощи jquery помещается шаблон, заполненный states -->
										<div id="manicurists-select" class="input-field"></div>
									</div>
								</div>
							</div>
						</li>
						<li>
							<div class="collapsible-header">
								<i class="material-icons">sort</i>Сортировка
							</div>
							<div class="collapsible-body">
								<form action="#">
									<p>
										<label> <input name="sort-group" type="radio" checked />
											<span>новизна</span>
										</label>
									</p>
									<p>
										<label> <input name="sort-group" type="radio" /> <span>от
												простых к сложным</span>
										</label>
									</p>
									<p>
										<label> <input name="sort-group" type="radio" /> <span>от
												сложных к простым</span>
										</label>
									</p>
								</form>
							</div>
						</li>
					</ul>
				</li>
			</ul>
			<a href="#" data-target="slide-out" class="sidenav-trigger"><i
				class="material-icons" style="pointer-events: none">settings</i></a>
		</div>
		<div class="col s11">
			<form>
				<div class="input-field">
					<input id="search" type="search" required> <label
						class="label-icon" for="search"><i class="material-icons">search</i></label>
					<i class="material-icons">close</i>
				</div>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript">

	$('.sidenav').sidenav();
	$('.collapsible').collapsible();
	
	/*$('input#country-input').autocomplete({
      data: {
        "USA": null,
        "Россия": null,
        "Украина": null
      },
    });*/

    $('input#city-input').autocomplete({
      data: {
        "Киев": null,
        "Львов": null,
        "Мариуполь": null
      },
    });
	
	app.handler(function() {

		//console.log('this ' + $(this));
		//var $container = $(this).find("#page-container");
		//console.log('container ' + $container);

		return function(params) {

			var countryAutocompleteItems = {};
			
			$.ajax({
				type: 'POST',
				url: '/offertype?action=get-all',
				dataType: 'json',
				cache: false
			}).done(function(responseText, textStatus, jqXHR) {
				  
				console.log(responseText);
				//Готовим шаблон списка при помощи библиотеки Hogan
	            var template = Hogan.compile(
	                '{{#result}}'
	                +'<p>'
						+'<label for="category-{{id}}"> <input id="category-{{id}}"'
							+'type="checkbox" /><span>{{description}}</span>'
						+'</label>'
					+'</p>'
					+'{{/result}}'
	            );
	            //Заполняем шаблон данными и помещаем на веб-страницу
				$('#categories').html(template.render(responseText));
				
			}).fail(function(jqXHR, textStatus, errorThrown) {
				  
				console.log(textStatus);
			});
			
			var onCountryAutocompleteCallback = function(){

		        /*$('#events-container').html('<div class="preloader-wrapper big active"> <div class="spinner-layer spinner-green-only"> <div class="circle-clipper left"> <div class="circle"></div> </div><div class="gap-patch"> <div class="circle"></div> </div><div class="circle-clipper right"> <div class="circle"></div> </div> </div> </div>');
		        $.ajax({
		            url: "/events-ajax",
		            type: "POST",
		            data: {
		                //'type': this.id
		                'action': 'fetch-events-by-title'
		                , 'title': $('input#search').val()
		            },
		            cache : false
		        }).done(function(data) {
		            
		            //помещаем на веб-страницу
		            $('#events-container').html(data);
		        });*/
				console.log("autocompleted");
			}
			
			//country autocomplete
		    $('input#country-input').autocomplete({
		        data: countryAutocompleteItems
		        , onAutocomplete: onCountryAutocompleteCallback
			});
			
		    var countryAutocomplete =
		    	M.Autocomplete.getInstance($('input#country-input'));
			
			$('input#country-input').keydown(function(e) { 
					
				// only user-triggered event
				 if (e.originalEvent) {
				 	
					 $.ajax({
					        url: "/country",
					        type: "POST",
					        data: {
					            'action': 'autocomplete'
					            , 'substring': $('input#country-input').val()
					        },
					        cache : false
					    }).done(function(newAutocompleteItems) {
					        
					    	//console.log(newAutocompleteItems);
					    	//console.log(JSON.parse(newAutocompleteItems));
					    	//console.log(newAutocompleteItems.result);
					    	//console.log(JSON.parse(newAutocompleteItems.result));
					    	//countryAutocomplete.updateData(JSON.parse(newAutocompleteItems.result));
					    	countryAutocomplete.updateData(JSON.parse(newAutocompleteItems.result));
					});
				 }
				 else {
				   // code-triggered event
				 }
			});

			var preloaderHide = function() {

				$(".preloader-wrapper").css("display", "none");
			}

			setTimeout(preloaderHide, 500);
		};
	});
</script>